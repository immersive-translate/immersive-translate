(()=>{var u={BUILD_TIME:"2026-02-11T12:28:28.000Z",VERSION:"1.26.4",PROD:"1",PROD_API:"1",BETA:"0",userscript_domains:'["google.com","translate.googleapis.com","api-edge.cognitive.microsofttranslator.com","edge.microsoft.com","transmart.qq.com","translate.yandex.net","tmt.tencentcloudapi.com","www2.deepl.com","w.deepl.com","immersive-translate.owenyoung.com","generativelanguage.googleapis.com","chat.openai.com","bing.com","www.bing.com","open.volcengineapi.com","fanyi.baidu.com","api.fanyi.baidu.com","api.interpreter.caiyunai.com","api-free.deepl.com","api.deepl.com","api.openl.club","openapi.youdao.com","translate.volcengine.com","api.niutrans.com","immersivetranslate.com","test-api2.immersivetranslate.com","api2.immersivetranslate.com","config.immersivetranslate.com","app.immersivetranslate.com","dash.immersivetranslate.com","api.immersivetranslate.com","immersive-translate.deno.dev","www.googleapis.com","www.google-analytics.com","translate-pa.googleapis.com","api.cognitive.microsofttranslator.com","api.groq.com","api.x.ai","api.papago-chrome.com","api.openai.com","api.interpreter.caiyunai.com","api.cognitive.microsofttranslator.com","aidemo.youdao.com","dict.youdao.com","openai.azure.com","mt.aliyuncs.com","subhub.weixin.so","api.anthropic.com","localhost","127.0.0.1","ai.immersivetranslate.com","test-ai.immersivetranslate.com","openrouter.ai","dashscope.aliyuncs.com","api.deepseek.com","aip.baidubce.com","ark.cn-beijing.volces.com","hunyuan.tencentcloudapi.com","public-beta-api.siliconflow.cn","api.siliconflow.cn","open.bigmodel.cn","store.immersivetranslate.com","qianfan.baidubce.com","aigw1.immersivetranslate.com"]',INSTALL_FROM:"chrome_zip",LOCAL_HTTPS:"0",MOCK:"0",DEBUG:"0"};function p(){return typeof process>"u"&&typeof Deno<"u"?Deno.env.toObject():u}var ye=p();function S(t){return t&&globalThis?.document?.querySelector("meta[name=immersive-translate-options]")?!!globalThis.document?.getElementById("immersive-translate-manifest")?.value?.includes("_isUserscript"):ye.IMMERSIVE_TRANSLATE_USERSCRIPT==="1"}var Ne=p().PROD==="1",B=p().PROD!=="1";var Te="";function h(){return Te||globalThis.navigator.userAgent}function x(){let t=h();return t.includes("ImtFxiOS")||t.includes("ImtiOS")}function E(){let t=h();return t.includes("ImtFxAndroid")||t.includes("ImtFxAOS")}function w(){if(!E())return!1;let t=h();return t.endsWith("official_cn")||t.includes("mainlandStore")}function L(){return x()?h().includes("mainland"):!1}var A=class{bridge;waitForBridge(e=1e4){return!E()&&!x()&&!be()?Promise.resolve(!1):globalThis.WebViewJavascriptBridge?(this.bridge=globalThis.WebViewJavascriptBridge,Promise.resolve(!0)):new Promise(r=>{let o=Date.now(),a=()=>{if(globalThis.WebViewJavascriptBridge)return this.bridge=globalThis.WebViewJavascriptBridge,r(!0);if(Date.now()-o>e)return r(!1);requestAnimationFrame(a)};a()})}registerHandler(e,r){this.bridge&&this.bridge.registerHandler(e,r)}callHandler(e,r,o){this.bridge&&this.bridge.doSend({type:e,...r},o)}},s=new A;function be(){return B?window.location.href.endsWith("browser.html"):!1}var I="DENO",y="CHROME",v="FIREFOX";function Se(t){let e;try{let r=navigator?.userAgent||"";/firefox/i.test(r)||typeof InstallTrigger<"u"?e=v:/deno/i.test(r)?e=I:/chrome/i.test(r)&&(e=y)}catch{}return t===y&&e===y||t===v&&e===v||t===I&&e===I}function U(t=!1){let e=p();return w()||L()?!0:!t&&e.region_plugin?e.region_plugin==="mainland":Se(y)&&e.IMMERSIVE_TRANSLATE_CN_CHROME==="1"}var n="immersiveTranslate";var c="immersive-translate",k="imt";var nt=n+"DeeplGlobalState",ot=n+"BingGlobalState",at=n+"YandexGlobalState",st=n+"BaiduQianfanGlobalConfigStorageKey",it=n+"SiliconCloudGlobalConfigStorageKey",lt=n+"IMT_COMMON_JWT_TOKEN",ct=n+"ZhipuGlobalConfigStorageKey";var ut=n+"GoogleAccessToken",dt=n+"AuthFlow",gt=c+"-config-latest.json",pt=n+"AuthState",mt=n+"IframeMessage",ft=n+"WaitForRateLimit",ht=n+"YoutubeIframePlayer",yt=n+"DocumentMessageAsk",M=n+"DocumentMessageTellThirdParty",D=n+"DocumentMessageThirdPartyTell",Tt=n+"DocumentMessageEventUpload",bt=n+"DocumentMessageTypeStopJsSDK",St=n+"DocumentMessageHandler",xt=n+"DocumentSetFloatBallActive",Et=`${n}Share`,At=`${n}ShowFloatBallGuide`,It=`${n}ShowPopupModalGuide`,vt=n+"DocumentMessageTempEnableSubtitleChanged",Mt=n+"DocumentMessageUpdateQuickButtonAiSubtitle",Pt=`${n}ToggleMouseHoverTranslateDirectly`,_t=`${n}ReqDraft`,Ct=`${n}ResDraft`,Rt=`${n}Container`,Ot=`${n}SpecifiedContainer`;var Nt=`${n}PageTranslatedStatus`,Bt=`${n}MangaTranslatedStatus`,wt=`${n}PageUrlChanged`,Lt=n+"LastUseMouseHoverTime",Ut=n+"LastUseInputTime",kt=n+"LastUseManualTranslatePageTime",Dt=`${n}PopupReceiveMessage`,Ft=`${n}SidePanelReceiveMessage`,Ht=n+"DocumentMessageEventTogglePopup",Wt=`${n}Mark`,Gt=`${n}Root`,$t=`${n}Walked`,Kt=`data-${c}-walked`,Vt=`${n}Paragraph`,qt=`data-${c}-paragraph`,Jt=`data-${c}-translation-element-mark`,Yt=`${n}TranslationElementMark`;var jt=`${n}TranslatedMark`,zt=`${c}-input-injected-css`,Xt=`${n}LoadingId`,Qt=`data-${c}-loading-id`,Zt=`${n}ErrorId`,er=`data-${c}-error-id`,tr=`${n}AtomicBlockMark`,rr=`${n}ExcludeMark`,nr=`data-${c}-exclude-mark`,or=`${n}StayOriginalMark`,ar=`${n}PreWhitespaceMark`,sr=`${n}InlineMark`,ir=`${n}BlockMark`,lr=`${n}Left`,cr=`${n}Right`,ur=`${n}Width`,dr=`${n}Height`,gr=`${n}Top`,pr=`${n}FontSize`;var mr=`${n}GlobalStyleMark`;var fr=`${c}-target-wrapper`,hr=`${c}-pdf-target-container`,yr=`${c}-target-inner`,Tr=`${c}-source-wrapper`,br=`${c}-target-translation-block-wrapper`,Sr=`${c}-root-translation-theme`,xr=`${n}RootTranslationTheme`,Er=`${c}-target-translation-vertical-block-wrapper`,Ar=`${c}-target-translation-pdf-block-wrapper`,Ir=`${c}-target-translation-pre-whitespace`,vr=`${c}-target-translation-inline-wrapper`;var Mr=[{name:"touch",shortcuts:[{command:"touchShortcutsToggleTranslatePage",type:"finger"},{command:"touchShortcutsToggleTranslationMask",type:"finger"},{command:"touchShortcutsToggleTranslatePageOnlyTranslation",type:"finger"},{command:"touchShortcutsToggleTranslateTouchElement",type:"finger"},{command:"touchShortcutsInputTranslate",type:"finger"}]},{name:"main",shortcuts:["toggleTranslatePage","translateInputBox","toggleSidePanel","openAiWritingModal"]},{name:"mouse",shortcuts:[{command:"mouseHoverHoldKey",type:"mouseHoverHoldKey"},"toggleMouseHoverTranslateDirectly"]},{name:"others",shortcuts:["toggleTranslationMask","toggleTranslateToThePageEndImmediately","toggleTranslateTheMainPage","toggleOnlyTransation","toggleTranslateTheWholePage","toggleVideoSubtitlePreTranslation"]},{name:"shortcutsForTranslationServices",shortcuts:U()?[{command:"translateWithCustom1",type:"translateWithCustom"},{command:"translateWithCustom2",type:"translateWithCustom"},{command:"translateWithCustom3",type:"translateWithCustom"}]:["translateWithDeepL","translateWithGoogle","translateWithOpenAI","translateWithBing","translateWithTransmart","translateWithGemini","translateWithClaude",{command:"translateWithCustom1",type:"translateWithCustom"},{command:"translateWithCustom2",type:"translateWithCustom"},{command:"translateWithCustom3",type:"translateWithCustom"}]}];var Pr={type:n+"ChildFrameToRootFrameIdentifier"};var _r=50*1e4,Cr=`[${k}-ctx-divider]`,Rr=`${k}_context_preview`;var Or=`${n}_selection_update_params`,Nr=`data-${c}-subtitle-type`,Br=`data-${c}-ai-subtitle-url`,wr=`data-${c}-has-subtitle`;var xe=["google","bing","siliconcloud","zhipu"],Ee=["deepseek","openai","claude","gemini","zhipu-pro","deepl","qwen-pro"];var Ae=["openai","claude","gemini"],Lr=[...xe,...Ee,...Ae];var Ur=c+"-large-cache";var P=class{constructor(){}getRandomId(){return(new Date().getTime()+Math.random())*Math.random()}sendAsyncMessages({type:e,data:r}){return new Promise(o=>{let a=this.getRandomId(),l=this.handleMessage(e,d=>{d.id===a&&(l(),o(d.payload))});this.sendMessages({type:e,id:a,data:r})})}sendMessages(e){globalThis.document.dispatchEvent(new CustomEvent(D,{detail:JSON.stringify({id:e.id||this.getRandomId(),type:e.type,data:e.data})}))}handleMessages(e){let r=o=>{let a=o;if(a.detail)try{let l=JSON.parse(a.detail);e(l)}catch{}};return globalThis.document.addEventListener(M,r),()=>{globalThis.document.removeEventListener(M,r)}}handleMessage(e,r){return this.handleMessages(o=>{o.type===e&&r(o)})}},F=new P,Ie={get(t,e,r){return e in t?(...o)=>{let a=t[e];return typeof a=="function"?a.apply(t,o):Reflect.get(t,e,r)}:o=>{if(e.startsWith("getAsync")||e.endsWith("Async"))return t.sendAsyncMessages({type:e,data:o});t.sendMessages({type:e,data:o})}}},i=new Proxy(F,Ie);function H(t,e){let r="right: unset; bottom: unset; left: 50%; top: 0; transform: translateX(-50%);";globalThis.innerWidth>450&&(r="left: unset; top: 0; right: 20px; bottom: unset; transform: none;"),i.togglePopup({style:t.style||r,isSheet:t.isSheet||!1,overlayStyle:t.overlayStyle||"background-color: transparent;"}),e({result:!0})}function W(t,e){let r="right: unset; bottom: unset; left: 50%; top: 0; transform: translateX(-50%);";globalThis.innerWidth>450&&(r="left: unset; top: 0; right: 20px; bottom: unset; transform: none;"),i.openPopup({style:t.style||r,isSheet:t.isSheet||!1,overlayStyle:t.overlayStyle||"background-color: transparent;"}),e({result:!0})}function G(t,e){i.closePopup(),e({result:!0})}function $(t,e){i.translatePage({...t||{},triggerSource:"mobileBridge"}),e({result:!0})}function K(t,e){i.restorePage(),e({result:!0})}async function V(t,e){let r=await i.getPageStatusAsync();e({result:!0,status:r,pageTranslated:r=="Translated"})}function q(t,e){i.openImageTranslationFeedback(),e({result:!0})}function J(t,e){i.openWebTranslationFeedback(),e({result:!0})}async function Y(t,e){let r=await i.getAsyncTranslationServiceList();e({result:!0,data:JSON.stringify(r)})}async function j(t,e){let r=await i.setMiniConfigAsync(t);e({result:!0,data:JSON.stringify(r)})}async function z(t,e){let r=!1;typeof t=="boolean"?r=t:typeof t=="string"?r=t==="true":typeof t=="object"&&(r=t.value);let o=await i.setMiniConfigAsync({forceAutoTranslate:r,triggerSource:"mobileBridge"});r&&i.translatePage({triggerSource:"mobileBridge"}),e({result:!0,data:JSON.stringify(o)})}async function X(t,e){let r=await i.agreeProtocolAndRefreshPageAsync(t||{});e({result:!0,data:r})}async function Q(t,e){let r=await i.updateUserConfigAsync(t);e({result:!0,data:JSON.stringify(r)})}async function Z(t,e){let r="dual";typeof t=="string"?r=t:typeof t=="object"&&(r=t.value);let o={translationMode:r,remember:!0},a=await i.switchTranslationMode({...o,triggerSource:"mobileBridge"});e({result:!0,data:JSON.stringify(a)})}async function ee(t,e){let r=await F.sendAsyncMessages({type:"updateTranslationThemeConfig",data:{...t,triggerSource:"mobileBridge"}});e({result:!0,data:JSON.stringify(r??{success:!0})})}async function te(t,e){let r=await i.getAsyncLanguageByText(t||"");e({result:!0,data:r})}async function re(t,e){await i.requestTermsContextByServices(t),e({result:!0})}async function ne(t,e){t.serviceConfig={disableTokensRatioFallback:!0,disableAIMultipleFallback:!0,enableFallback:!1,...t.serviceConfig};let r=await i.getAsyncTranslateContent(t);if(!r.sentences){e({result:!1,error:r});return}e({result:!0,data:r.sentences})}async function oe(t,e){let r=await i.getAllLanguageListAsync(t);e({result:!0,data:r})}async function ae(t,e){let r=await i.getMiniConfigAsync({triggerSource:"mobileBridge"});e({result:!0,data:r})}async function se(t,e){await i.syncUserLoginSetting(),e({result:!0})}async function ie(t,e){await i.updateUserInfo(),e({result:!0})}var T=[];function le(t,e){try{let{imageUrl:r}=t;if(!C(r))return e({result:!1,errMsg:"\u56FE\u7247\u4E0D\u5B58\u5728"});R({originalUrl:r,triggerResultCallback:e}),i.triggerTranslateImageBySrc(r)}catch{e({result:!1,errMsg:"\u7FFB\u8BD1\u8FC7\u7A0B\u53D1\u751F\u9519\u8BEF"})}}function ce(t,e){let{imageId:r,imageUrl:o}=t,a="";if(o){let l=C(o);l||e({result:!1,errMsg:"\u627E\u4E0D\u5230\u539F\u56FE"}),a=l?.getAttribute("bak_src")||""}else{let l=m({urlHash:r});if(!l){e({result:!1,errMsg:"\u627E\u4E0D\u5230\u7FFB\u8BD1\u540E\u7684\u56FE"});return}if(!C(l.originalUrl)){e({result:!1,errMsg:"\u627E\u4E0D\u5230\u539F\u56FE"});return}a=l.originalUrl}i.cleanTranslateImageBySrc(a)}function ue(t){let{urlHash:e,imgData:r,originalUrl:o}=t,a=m({originalUrl:o});a||(a={originalUrl:o,urlHash:e}),a.urlHash=e,R(a),_(e,{state:"extension_uploading",errorMsg:""}),s.callHandler("imageTextRecognition",{imageId:e,imageUrl:o,imageData:r},function(l){let{imageId:d,boxes:g,result:O,errMsg:N}=l;O&&g&&_(d,{state:"saved",errorMsg:"",result:{ocrTime:0,boxesWithText:g}}),!O&&N&&_(d,{state:"error",errorMsg:N})})}function de(t){let{urlHash:e}=t,r=m({urlHash:e});if(!r)return;let o=r.imgState;return{urlHash:e,state:o}}function ge(t){let{imgHash:e,originalUrl:r,ok:o,errMsg:a}=t,l=m({originalUrl:r});l&&(R(l),l.triggerResultCallback?.({result:o,errMsg:a}))}function R(t){let e=ve(t);if(e!==-1){T[e]=t;return}T.push(t)}function _(t,e){let r=m({urlHash:t});r&&(r.imgState=e)}function ve(t){return T.findIndex(e=>t.urlHash===e.urlHash||t.originalUrl===e.originalUrl)}function m(t){return T.find(e=>t.urlHash===e.urlHash||t.originalUrl===e.originalUrl)}function C(t){let e=document.querySelector(`img[src="${t}"]`)||document.querySelector(`img[bak_src="${t}"]`);if(e)return e;let r=document.querySelector(`[srcset*="${t}"]`)||document.querySelector(`[bak_srcset*="${t}"]`);return r instanceof HTMLSourceElement?r.parentElement?.querySelector("img"):r instanceof HTMLImageElement?r:r instanceof HTMLPictureElement?r.querySelector("img"):null}var f=class{from;to;constructor(e){this.from=e.from,this.to=e.to}sendMessages(e){let r={type:e.type,data:e.data,id:e.id||this.getRandomId(),isAsync:!1};globalThis.document.dispatchEvent(new CustomEvent(this.to,{detail:JSON.stringify(r)}))}getRandomId(){return Math.random()*1e17+new Date().getTime()}sendAsyncMessages({type:e,data:r}){return new Promise(o=>{let a=this.handleMessages(g=>{g.id===l&&(o(g.data),a())}),l=this.getRandomId(),d={type:e,data:r,id:l,isAsync:!0};globalThis.document.dispatchEvent(new CustomEvent(this.to,{detail:JSON.stringify(d)}))})}handleMessageOnce(e){return new Promise(r=>{let o=this.handleMessage(e,a=>{r(a.data),o()})})}handleMessage(e,r){return this.handleMessages(o=>{o.type===e&&r(o)})}handleMessages(e){let r=o=>{let l=JSON.parse(o.detail||"{}");l&&typeof l=="object"&&e(l)};return globalThis.document.addEventListener(this.from,r),()=>{globalThis.document.removeEventListener(this.from,r)}}},pe={get(t,e,r){return e in t?(...o)=>{let a=t[e];return typeof a=="function"?a.apply(t,o):Reflect.get(t,e,r)}:o=>t.sendAsyncMessages({type:e,data:o})}};var me="imt-browser-bridge-event-to-content-script",fe="imt-browser-bridge-event-to-inject",Me=new f({from:me,to:fe}),b=new f({from:fe,to:me}),jr=new Proxy(Me,pe);async function Pe(){try{if(!await s.waitForBridge())return;s.registerHandler("translateImage",le),s.registerHandler("restoreImage",ce),s.registerHandler("translatePage",$),s.registerHandler("restorePage",K),s.registerHandler("getPageStatus",V),s.registerHandler("togglePopup",H),s.registerHandler("openPopup",W),s.registerHandler("closePopup",G),s.registerHandler("getTranslationServiceList",Y),s.registerHandler("setMiniConfig",j),s.registerHandler("forceAutoTranslate",z),s.registerHandler("updateUserConfig",Q),s.registerHandler("switchTranslationMode",Z),s.registerHandler("updateTranslationThemeConfig",ee),s.registerHandler("openImageTranslationFeedback",q),s.registerHandler("openWebTranslationFeedback",J),s.registerHandler("detectLanguage",te),s.registerHandler("requestTermsContextByServices",re),s.registerHandler("translateText",ne),s.registerHandler("getAllLanguageList",oe),s.registerHandler("getMiniConfig",ae),s.registerHandler("agreeProtocolAndRefreshPage",X),s.registerHandler("syncUserLoginSetting",se),s.registerHandler("updateUserInfo",ie),_e(),b.sendMessages({type:"bridgeReady"})}catch{}}function _e(){b.handleMessages(async t=>{try{let{type:e,data:r}=t,o=null;if(e==="triggerClientTranslateImage")ue(r);else if(e==="queryImageTranslateState")o=de(r);else if(e==="notifyClientImageTranslatedResult")ge(r);else if(e==="getUserInfo")o=await Ce();else if(e==="getBaseInfo")o=await Re();else if(e==="updatePageStatus")s.callHandler("updatePageStatus",r,a=>{});else if(e==="openPage")s.callHandler("openPage",r,a=>{});else return;b.sendMessages({type:e,id:t.id,data:o})}catch{}})}function Ce(){return new Promise(t=>{s.callHandler("getUserInfo",{},e=>{e.data?t(e.data):t(null)})})}function Re(){return new Promise(t=>{s.callHandler("getBaseInfo",{},e=>{e.data?t(e.data):t(null)})})}S()||Pe();})();
